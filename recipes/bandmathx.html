

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>BandMathImageFilterX (based on muParserX) &mdash; Orfeo ToolBox 6.7.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/otb_theme.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Enhance local contrast" href="contrast_enhancement.html" />
    <link rel="prev" title="Image processing and information extraction" href="improc.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/logo-with-text.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                6.7.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Get Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Monteverdi.html">Monteverdi</a></li>
</ul>
<p class="caption"><span class="caption-text">Applications</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../CliInterface.html">Command-line interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../GraphicalInterface.html">Graphical interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PythonAPI.html">Python API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../QGISInterface.html">QGIS interface</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../Recipes.html">Recipes</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="optpreproc.html">From raw image to calibrated product</a></li>
<li class="toctree-l2"><a class="reference internal" href="sarprocessing.html">SAR processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="residual_registration.html">Residual registration</a></li>
<li class="toctree-l2"><a class="reference internal" href="improc.html">Image processing and information extraction</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">BandMathImageFilterX (based on muParserX)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#fundamentals-headers-declaration-and-instantiation">Fundamentals: headers, declaration and instantiation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#syntax-first-elements">Syntax: first elements</a></li>
<li class="toctree-l3"><a class="reference internal" href="#new-operators-and-functions">New operators and functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#application-programming-interface-api">Application Programming Interface (API)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="contrast_enhancement.html">Enhance local contrast</a></li>
<li class="toctree-l2"><a class="reference internal" href="pbclassif.html">Classification</a></li>
<li class="toctree-l2"><a class="reference internal" href="featextract.html">Feature extraction</a></li>
<li class="toctree-l2"><a class="reference internal" href="stereo.html">Stereoscopic reconstruction from VHR optical images pair</a></li>
<li class="toctree-l2"><a class="reference internal" href="hyperspectral.html">Hyperspectral image processing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Applications.html">All Applications</a></li>
</ul>
<p class="caption"><span class="caption-text">Advanced use</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../EnvironmentVariables.html">Environment variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ExtendedFilenames.html">Extended filenames</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CompilingOTBFromSource.html">Compiling OTB from source</a></li>
<li class="toctree-l1"><a class="reference internal" href="../C++.html">C++ API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../FAQ.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Contributors.html">Contributors</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Orfeo ToolBox</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../Recipes.html">Recipes</a> &raquo;</li>
        
      <li>BandMathImageFilterX (based on muParserX)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://gitlab.orfeo-toolbox.org/orfeotoolbox/OTB/blob/develop/Documentation/Cookbook/rst/recipes/bandmathx.rst" class="fa fa-gitlab"> Edit on GitLab</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="bandmathimagefilterx-based-on-muparserx">
<h1>BandMathImageFilterX (based on muParserX)<a class="headerlink" href="#bandmathimagefilterx-based-on-muparserx" title="Permalink to this headline">¶</a></h1>
<p>This section describes how to use the BandMathImageFilterX.</p>
<div class="section" id="fundamentals-headers-declaration-and-instantiation">
<h2>Fundamentals: headers, declaration and instantiation<a class="headerlink" href="#fundamentals-headers-declaration-and-instantiation" title="Permalink to this headline">¶</a></h2>
<p>A simple example is given below:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;otbBandMathImageFilterX.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;otbVectorImage.h&quot;</span><span class="cp"></span>
</pre></div>
</div>
<p>As we can see, the new band math filter works with the class
otb::VectorImage.</p>
</div>
<div class="section" id="syntax-first-elements">
<span id="syntax"></span><h2>Syntax: first elements<a class="headerlink" href="#syntax-first-elements" title="Permalink to this headline">¶</a></h2>
<p>The default prefix name for variables related to the ith input is
<em>im(i+1)</em> (note the indexing from 1 to N, for N inputs). The user has
the possibility of changing this default behaviour by setting its own
prefix.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// All variables related to image1 (input 0) will have the prefix im1</span>
<span class="n">filter</span><span class="o">-&gt;</span><span class="n">SetNthInput</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">image1</span><span class="p">);</span>

<span class="c1">// All variables related to image2 (input 1) will have the prefix  toulouse</span>
<span class="n">filter</span><span class="o">-&gt;</span><span class="n">SetNthInput</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">image2</span><span class="p">,</span> <span class="s">&quot;toulouse&quot;</span><span class="p">);</span>

<span class="c1">// All variables related to anotherImage (input 2) will have the prefix im3</span>
<span class="n">filter</span><span class="o">-&gt;</span><span class="n">SetNthInput</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">anotherImage</span><span class="p">);</span>
</pre></div>
</div>
<p>In this document, we will keep the default convention. The following list
summarises the available variables for input #0 (and so on for every
input).</p>
<p>Variables and their descriptions:</p>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="72%" />
<col width="8%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Variables</th>
<th class="head">Description</th>
<th class="head">Type</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>im1</td>
<td>a pixel from first input, made of n components/bands (first image is indexed by 1)</td>
<td>Vector</td>
</tr>
<tr class="row-odd"><td>im1bj</td>
<td>jth component of a pixel from first input (first band is indexed by 1)</td>
<td>Scalar</td>
</tr>
<tr class="row-even"><td>im1bjNkxp</td>
<td>a neighbourhood (”N”) of pixels of the jth component from first input, of size kxp</td>
<td>Matrix</td>
</tr>
<tr class="row-odd"><td>im1bjMini</td>
<td>global statistic: minimum of the jth band from first input</td>
<td>Scalar</td>
</tr>
<tr class="row-even"><td>im1bjMaxi</td>
<td>global statistic: maximum of the jth band from first input</td>
<td>Scalar</td>
</tr>
<tr class="row-odd"><td>im1bjMean</td>
<td>global statistic: mean of the jth band from first input</td>
<td>Scalar</td>
</tr>
<tr class="row-even"><td>im1bjSum</td>
<td>global statistic: sum of the jth band from first input</td>
<td>Scalar</td>
</tr>
<tr class="row-odd"><td>im1bjVar</td>
<td>global statistic: variance of the jth band from first input</td>
<td>Scalar</td>
</tr>
<tr class="row-even"><td>im1PhyX and im1PhyY</td>
<td>spacing of first input in X and Y directions</td>
<td>Scalar</td>
</tr>
</tbody>
</table>
<p>[variables]</p>
<p>In addition, we also have the generic variables idxX and idxY that
represent the indices of the current pixel (scalars).</p>
<p>Note that the use of a global statistics will automatically make the
filter (or the application) request the largest possible regions from
the concerned input images, without user intervention.</p>
<p>For instance, the following formula (addition of two pixels)</p>
<div class="math">
<p><img src="../_images/math/202cd6b47e59491342085a6fcd99a870da71b732.png" alt="im1+im2"/></p>
</div><p>[firstequation]</p>
<p>is correct only if the two first inputs have the same number of bands.
In addition, the following formula is not consistent even if im1
represents a pixel of an image made of only one band:</p>
<div class="math">
<p><img src="../_images/math/cc37ffbce406e72aaebec2eff1c889b509b2cb8a.png" alt="im1+1"/></p>
</div><p>A scalar can’t be added to a vector. The right formula is instead (one
can notice the way that muParserX allows vectors to be defined on the fly):</p>
<div class="math">
<p><img src="../_images/math/309ac82153d2cf25d3c755cb0cc61a90e013b5df.png" alt="im1+\{ 1 \}"/></p>
</div><p>or</p>
<div class="math">
<p><img src="../_images/math/0712ab658480fd878b0738280e0c4e10766cfe25.png" alt="im1 + \{1,1,1,...,1\}"/></p>
</div><p>if im1 is made of n components.</p>
<p>On the other hand, the variable im1b1 for instance is represented as a
scalar; so we have the following different possibilities:</p>
<p>Correct / incorrect expressions:</p>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="78%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Expression</th>
<th class="head">Status</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>im1b1 + 1</td>
<td>correct</td>
</tr>
<tr class="row-odd"><td>{im1b1} + {1}</td>
<td>correct</td>
</tr>
<tr class="row-even"><td>im1b1 + {1}</td>
<td>incorrect</td>
</tr>
<tr class="row-odd"><td>{im1b1} + 1</td>
<td>incorrect</td>
</tr>
<tr class="row-even"><td>im1 + {im2b1,im2b2}</td>
<td>correct if im1 represents a pixel of two components (equivalent to im1 + im2)</td>
</tr>
</tbody>
</table>
<p>Similar remarks can be made for the multiplication/division; for
instance, the following formula is incorrect:</p>
<div class="math">
<p><img src="../_images/math/a89adf22894baa57c6a4a34861f1efacb791b437.png" alt="\{im2b1,im2b2\} * \{1,2\}"/></p>
</div><p>whereas this one is correct:</p>
<div class="math">
<p><img src="../_images/math/33cd3d70c40f04ca9cdd221a7983d97d807a9f40.png" alt="\{im2b1,im2b2\} * \{1,2\}'"/></p>
</div><p>or in more simple terms (and only if im2 contains two components):</p>
<div class="math">
<p><img src="../_images/math/b130e65f3ede637583949a8674a2a6c80f63ec8d.png" alt="im2* \{1,2\}'"/></p>
</div><p>Concerning division, this operation is not originally defined between
two vectors (see next section <a class="reference internal" href="#operators"><span class="std std-ref">New operators and functions</span></a>).</p>
<p>Now, let’s go back to the first formula: this one specifies the addition
of two images band to band. With muParserX lib, we can now define such
operation with only one formula, instead of many formulas (as many as
the number of bands). We call this new functionality the <strong>batch mode</strong>,
which directly arises from the introduction of vectors within muParserX
framework.</p>
<p>Finally, let’s say a few words about neighbourhood variables. These
variables are defined for each particular input, and for each particular
band. The two last numbers, kxp, indicate the size of the neighbourhood.
All neighbourhoods are centred: this means that k and p can only be odd
numbers. Moreover, k represents the dimension in the x direction (number
of columns), and p the dimension in the y direction (number of rows).
For instance, im1b3N3x5 represents the following neighbourhood:</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">.</th>
<th class="head">.</th>
<th class="head">.</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>.</td>
<td>.</td>
<td>.</td>
</tr>
<tr class="row-odd"><td>.</td>
<td>.</td>
<td>.</td>
</tr>
<tr class="row-even"><td>.</td>
<td>.</td>
<td>.</td>
</tr>
<tr class="row-odd"><td>.</td>
<td>.</td>
<td>.</td>
</tr>
</tbody>
</table>
<p>[correctness]</p>
<p>Fundamentally, a neighbourhood is represented as a matrix inside the
muParserX framework; so the remark about mathematically well-defined
formulas still stands.</p>
</div>
<div class="section" id="new-operators-and-functions">
<span id="operators"></span><h2>New operators and functions<a class="headerlink" href="#new-operators-and-functions" title="Permalink to this headline">¶</a></h2>
<p>New operators and functions have been implemented within
BandMathImageFilterX. These ones can be divided into two categories.</p>
<ul class="simple">
<li>adaptation of existing operators/functions, that were not originally
defined for vectors and matrices (for instance cos, sin, …). These
new operators/ functions keep the original names to which we add the
prefix “v” for vector (vcos, vsin, …) .</li>
<li>truly new operators/functions.</li>
</ul>
<p>Concerning the last category, here is a list of implemented operators or
functions (they are all implemented in otbParserXPlugins.h/.cxx files
-OTB/Code/Common-):</p>
<p><strong>Operators div and dv</strong> The first operator allows the definition of an
element-wise division of two vectors (and even matrices), provided that
they have the same dimensions. The second one allows the definition of
the division of a vector/matrix by a scalar (components are divided by
the same unique value). For instance:</p>
<div class="math">
<p><img src="../_images/math/d83cb8ae528364371f56e919fcccc7b2f8e0ae6d.png" alt="im1 ~ div ~ im2"/></p>
</div><div class="math">
<p><img src="../_images/math/726f84ebcdfa0abf52f397ff34ba704442de0628.png" alt="im1 ~ dv ~ 2.0"/></p>
</div><p><strong>Operators mult and mlt</strong> These operators are the duals of the previous
ones. For instance:</p>
<div class="math">
<p><img src="../_images/math/91c67d50dbddbd5208e33c17e8f727ffbdb6e076.png" alt="im1 ~  mult ~ im2"/></p>
</div><div class="math">
<p><img src="../_images/math/6a47845aba442fc5bc0cad217fe0d4c3730bcace.png" alt="im1 ~  mlt ~ 2.0"/></p>
</div><p>Note that the operator ’*’ could have been used instead of ’pw’ one.
But ’pw’ is a little bit more permissive, and can tolerate a
one-dimensional vector as the right operand.</p>
<p><strong>Operators pow and pw</strong> The first operator allows the definition of an
element-wise exponentiation of two vectors (and even matrices), provided
that they have the same dimensions. The second one allows the definition
of the division of a vector/matrix by a scalar (components are
exponentiated by the same unique value). For instance:</p>
<div class="math">
<p><img src="../_images/math/b6b50e555e1139ae7fe7d7bd786f20c5e7d48e9c.png" alt="im1 ~ pow ~ im2"/></p>
</div><div class="math">
<p><img src="../_images/math/6cb3c735afc750386e9fb2693875f4b2e4ee64c5.png" alt="im1 ~ pw ~ 2.0"/></p>
</div><p><strong>Function bands</strong> This function allows to select specific bands from an
image, and/or to rearrange them in a new vector; for instance:</p>
<div class="math">
<p><img src="../_images/math/4fc4e0c40ed54e3443c153f21cdc2adcc3e9fb3a.png" alt="bands(im1,\{1,2,1,1\})"/></p>
</div><p>produces a vector of 4 components made of band 1, band 2, band 1 and
band 1 values from the first input. Note that curly brackets must be
used in order to select the desired band indices.</p>
<p>** Function dotpr ** This function allows the dot product between two
vectors or matrices (actually in our case, a kernel and a neighbourhood
of pixels):</p>
<div class="math">
<p><img src="../_images/math/e5d67d56a85a4a027b0c39d74cb8d1eb14062bb1.png" alt="\sum_{(i,j)} m_1(i,j)*m_2(i,j)"/></p>
</div><p>For instance:</p>
<div class="math">
<p><img src="../_images/math/a31df62cac7ccc2051cea53b731048b316621171.png" alt="dotpr(kernel1,im1b1N3x5)"/></p>
</div><p>is correct provided that kernel1 and im1b1N3x5 have the same dimensions.
The function can take as many neighbourhoods as needed in inputs.</p>
<p><strong>Function mean</strong> This function allows to compute the mean value of a
given vector or neighborhood (the function can take as many inputs as
needed; one mean value is computed per input). For instance:</p>
<div class="math">
<p><img src="../_images/math/fdf250411bc34785152e77545864be07557d79b5.png" alt="mean(im1b1N3x3,im1b2N3x3,im1b3N3x3,im1b4N3x3)"/></p>
</div><p>Note: a limitation coming from muparserX itself makes it impossible to pass
all those neighborhoods with a unique variable.</p>
<p><strong>Function var</strong> This function computes the variance of a given
vector or neighborhood (the function can take as many inputs as needed;
one var value is computed per input). For instance:</p>
<div class="math">
<p><img src="../_images/math/52c9ed70170faf2fb5e54e5609791a1af431cf70.png" alt="var(im1b1N3x3)"/></p>
</div><p><strong>Function median</strong> This function computes the median value of
a given vector or neighborhood (the function can take as many inputs as
needed; one median value is computed per input). For instance:</p>
<div class="math">
<p><img src="../_images/math/66bb103967477412b5072ac4de26de841a20dfcb.png" alt="median(im1b1N3x3)"/></p>
</div><p><strong>Function corr</strong> This function computes the correlation
between two vectors or matrices of the same dimensions (the function
takes two inputs). For instance:</p>
<div class="math">
<p><img src="../_images/math/9d60ae2487e12573db5aae1aae8608ff0ca0c128.png" alt="corr(im1b1N3x3,im1b2N3x3)"/></p>
</div><p><strong>Function maj</strong> This function computes the most represented
element within a vector or a matrix (the function can take as many
inputs as needed; one maj element value is computed per input). For
instance:</p>
<div class="math">
<p><img src="../_images/math/6d7ba8eeca086a0352077bdbef4fe476ee661409.png" alt="maj(im1b1N3x3,im1b2N3x3)"/></p>
</div><p><strong>Function vmin and vmax</strong> These functions calculate the min or
max value of a given vector or neighborhood (only one input). For
instance:</p>
<div class="math">
<p><img src="../_images/math/6a075bfd8b5e1b44e0db4bd09d061aaf1f36ceb1.png" alt="(vmax(im3b1N3x5)+vmin(im3b1N3x5)) ~ div ~ \{2.0\}"/></p>
</div><p><strong>Function cat</strong> This function concatenates the results of
several expressions into a multidimensional vector, whatever their
respective dimensions (the function can take as many inputs as needed).
For instance:</p>
<div class="math">
<p><img src="../_images/math/79b9eeb2333e974961f60e1b5327f32971ef2156.png" alt="cat(im3b1,vmin(im3b1N3x5),median(im3b1N3x5),vmax(im3b1N3x5))"/></p>
</div><p>Note: the user should prefer the use of semi-colons (;) when setting
expressions, instead of directly use this function. The filter or the
application will call the function ’cat’ automatically. For instance:</p>
<div class="math">
<p><img src="../_images/math/c6e13cfd01d93c0a561505b30c961a97f3b4abc4.png" alt="filter-&gt;SetExpression(&quot;im3b1 ; vmin(im3b1N3x5) ; median(im3b1N3x5) ; vmax(im3b1N3x5)&quot;);"/></p>
</div><p>Please, also refer to the next section <a class="reference internal" href="#api"><span class="std std-ref">Application Programming Interface (API)</span></a>.</p>
<p><strong>Function ndvi</strong> This function implements the classical normalized
difference vegetation index; it takes two inputs. For instance:</p>
<div class="math">
<p><img src="../_images/math/1d86c591e3d8504aa731874a7deca7aa3b23a75e.png" alt="ndvi(im1b1,im1b4)"/></p>
</div><p>First argument is related to the visible red band, and the second one to
the near-infrared band.</p>
<p>The table below summarises the different functions and operators.</p>
<p>Functions and operators summary:</p>
<table border="1" class="docutils">
<colgroup>
<col width="17%" />
<col width="83%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Variables</th>
<th class="head">Remark</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>ndvi</td>
<td>two inputs</td>
</tr>
<tr class="row-odd"><td>bands</td>
<td>two inputs; length of second vector input gives the dimension of the output</td>
</tr>
<tr class="row-even"><td>dotptr</td>
<td>many inputs</td>
</tr>
<tr class="row-odd"><td>cat</td>
<td>many inputs</td>
</tr>
<tr class="row-even"><td>mean</td>
<td>many inputs</td>
</tr>
<tr class="row-odd"><td>var</td>
<td>many inputs</td>
</tr>
<tr class="row-even"><td>median</td>
<td>many inputs</td>
</tr>
<tr class="row-odd"><td>maj</td>
<td>many inputs</td>
</tr>
<tr class="row-even"><td>corr</td>
<td>two inputs</td>
</tr>
<tr class="row-odd"><td>div and dv</td>
<td>operators</td>
</tr>
<tr class="row-even"><td>mult and mlt</td>
<td>operators</td>
</tr>
<tr class="row-odd"><td>pow and pw</td>
<td>operators</td>
</tr>
<tr class="row-even"><td>vnorm</td>
<td>adapation of an existing function to vectors: one input</td>
</tr>
<tr class="row-odd"><td>vabs</td>
<td>adapation of an existing function to vectors: one input</td>
</tr>
<tr class="row-even"><td>vmin</td>
<td>adapation of an existing function to vectors: one input</td>
</tr>
<tr class="row-odd"><td>vmax</td>
<td>adapation of an existing function to vectors: one input</td>
</tr>
<tr class="row-even"><td>vcos</td>
<td>adapation of an existing function to vectors: one input</td>
</tr>
<tr class="row-odd"><td>vsin</td>
<td>adapation of an existing function to vectors: one input</td>
</tr>
<tr class="row-even"><td>vtan</td>
<td>adapation of an existing function to vectors: one input</td>
</tr>
<tr class="row-odd"><td>vtanh</td>
<td>adapation of an existing function to vectors: one input</td>
</tr>
<tr class="row-even"><td>vsinh</td>
<td>adapation of an existing function to vectors: one input</td>
</tr>
<tr class="row-odd"><td>vcosh</td>
<td>adapation of an existing function to vectors: one input</td>
</tr>
<tr class="row-even"><td>vlog</td>
<td>adapation of an existing function to vectors: one input</td>
</tr>
<tr class="row-odd"><td>vlog10</td>
<td>adapation of an existing function to vectors: one input</td>
</tr>
<tr class="row-even"><td>vexp</td>
<td>adapation of an existing function to vectors: one input</td>
</tr>
<tr class="row-odd"><td>vsqrt</td>
<td>adapation of an existing function to vectors: one input</td>
</tr>
</tbody>
</table>
<p>[variables]</p>
</div>
<div class="section" id="application-programming-interface-api">
<span id="api"></span><h2>Application Programming Interface (API)<a class="headerlink" href="#application-programming-interface-api" title="Permalink to this headline">¶</a></h2>
<p>In this section, we make some comments about the public member functions
of the new band math filter.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cm">/** Set the nth filter input with or without a specified associated variable name */</span>
<span class="kt">void</span> <span class="nf">SetNthInput</span><span class="p">(</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">idx</span><span class="p">,</span> <span class="k">const</span> <span class="n">ImageType</span> <span class="o">*</span> <span class="n">image</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">SetNthInput</span><span class="p">(</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">idx</span><span class="p">,</span> <span class="k">const</span> <span class="n">ImageType</span> <span class="o">*</span> <span class="n">image</span><span class="p">,</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">varName</span><span class="p">);</span>

<span class="cm">/** Return a pointer on the nth filter input */</span>
<span class="n">ImageType</span> <span class="o">*</span> <span class="nf">GetNthInput</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">idx</span><span class="p">);</span>
</pre></div>
</div>
<p>Refer to the section <a class="reference internal" href="#syntax"><span class="std std-ref">Syntax: first elements</span></a>, where the
two first functions have already been commented. The function
GetNthInput is quite clear to understand.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cm">/** Set an expression to be parsed */</span>
<span class="kt">void</span> <span class="nf">SetExpression</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">expression</span><span class="p">);</span>
</pre></div>
</div>
<p>Each time the function SetExpression is called, a new expression is
pushed inside the filter. <strong>There are as many outputs as there are
expressions. The dimensions of the outputs (number of bands) are totally
dependent on the dimensions of the related expressions (see also last
remark of the section :ref:`syntax`).</strong> Thus,
the filter always performs a pre-evaluation of each expression, in order
to guess how to allocate the outputs.</p>
<p>The concatenation of the results of many expressions (whose results can
have different dimensions) into one unique output is possible. For that
purpose, semi-colons (“;”) are used as separating characters. For
instance:</p>
<div class="math">
<p><img src="../_images/math/d50b46589d526d239289d919f97c9ad1b620a5ea.png" alt="filter-&gt;SetExpression(&quot;im1 + im2 ; im1b1*im2b1&quot;);"/></p>
</div><p>will produce a unique output (one expression) of many bands (actually,
number of bands of im1 + 1).</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cm">/** Return the nth expression to be parsed */</span>
<span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">GetExpression</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
</pre></div>
</div>
<p>This function allows the user to get any expression by its ID number.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cm">/** Set a matrix (or a vector) */</span>
<span class="kt">void</span> <span class="nf">SetMatrix</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">name</span><span class="p">,</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">definition</span><span class="p">);</span>
</pre></div>
</div>
<p>This function allows the user to set new vectors or matrices. This is
particularly useful when the user wants to use the dotpr function (see
previous section). First argument is related to the name of the
variable, and the second one to the definition of the vector/matrix. The
definition is done by a string, where first and last elements must be
curly brackets (“{” and “}”). Different elements of a row are separated
by commas (“,”), and different rows are separated by semi-colons (“;”).
For instance:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">filter</span><span class="o">-&gt;</span><span class="n">SetMatrix</span><span class="p">(</span><span class="s">&quot;kernel1&quot;</span><span class="p">,</span><span class="s">&quot;{ 0.1 , 0.2 , 0.3 ; 0.4 , 0.5 , 0.6 ; \</span>
<span class="s">0.7 , 0.8 , 0.9 ; 1.0 , 1.1 , 1.2 ; 1.3 , 1.4 , 1.5 }&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>defines the kernel1, whose elements are given as follows:</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">0,1</th>
<th class="head">0,2</th>
<th class="head">0,3</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>0,4</td>
<td>0,5</td>
<td>0,6</td>
</tr>
<tr class="row-odd"><td>0,7</td>
<td>0,8</td>
<td>0,9</td>
</tr>
<tr class="row-even"><td>1,0</td>
<td>1,1</td>
<td>1,2</td>
</tr>
<tr class="row-odd"><td>1,3</td>
<td>1,4</td>
<td>1,5</td>
</tr>
</tbody>
</table>
<p>Definition of kernel1.</p>
<p>[correctness]</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cm">/** Set a constant */</span>
<span class="kt">void</span> <span class="nf">SetConstant</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">name</span><span class="p">,</span> <span class="kt">double</span> <span class="n">value</span><span class="p">);</span>
</pre></div>
</div>
<p>This function allows the user to set new constants.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cm">/** Return the variable and constant names */</span>
<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">GetVarNames</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
</pre></div>
</div>
<p>This function allows the user to get the list of the variable and
constant names, in the form of a std::vector of strings.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cm">/** Import constants and expressions from a given filename */</span>
<span class="kt">void</span> <span class="nf">ImportContext</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">filename</span><span class="p">);</span>
</pre></div>
</div>
<p>This function allows the user to define new constants and/or expressions
(context) by using a txt file with a specific syntax. For the definition
of constants, the following pattern must be observed: #type name value.
For instance:</p>
<p>#F expo 1.1 #M kernel1 { 0.1 , 0.2 , 0.3 ; 0.4 , 0.5 , 0.6 ; 0.7 , 0.8 ,
0.9 ; 1 , 1.1 , 1.2 ; 1.3 , 1.4 , 1.5 }</p>
<p>As we can see, #I/#F allows the definition of an integer/float constant,
whereas #M allows the definition of a vector/matrix. It is also possible
to define expressions within the same txt file, with the pattern #E
expr. For instance:</p>
<p>#F expo 1.1 #M kernel1 0.1 , 0.2 , 0.3 ; 0.4 , 0.5 , 0.6 ; 0.7 , 0.8 ,
0.9 ; 1 , 1.1 , 1.2 ; 1.3 , 1.4 , 1.5 #E dotpr(kernel1,im1b1N3x5)</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cm">/** Export constants and expressions to a given filename */</span>
<span class="kt">void</span> <span class="nf">ExportContext</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">filename</span><span class="p">);</span>
</pre></div>
</div>
<p>This function allows the user to export a text file that saves its
favorite constant or expression definitions. Such a file will be
reusable by the ImportContext function (see above).</p>
<p>Please, also refer to the section dedicated to application.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="contrast_enhancement.html" class="btn btn-neutral float-right" title="Enhance local contrast" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="improc.html" class="btn btn-neutral" title="Image processing and information extraction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019 CNES. The OTB CookBook is licensed under a Creative Commons Attribution-ShareAlike 4.0 International license (CC-BY-SA).

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/js/versions.js"></script>
    

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>