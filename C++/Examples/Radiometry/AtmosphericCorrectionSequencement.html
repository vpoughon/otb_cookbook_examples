

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>AtmosphericCorrectionSequencement.cxx &mdash; OTB CookBook 6.7.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/otb_theme.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="NDVIRAndNIRVegetationIndexImageFilter.cxx" href="NDVIRAndNIRVegetationIndexImageFilter.html" />
    <link rel="prev" title="AVIMultiChannelRAndGAndNIRVegetationIndexImageFilter.cxx" href="AVIMultiChannelRAndGAndNIRVegetationIndexImageFilter.html" /> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index_TOC.html" class="icon icon-home"> OTB CookBook
          

          
            
            <img src="../../../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                6.7.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Welcome to Orfeo ToolBox!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../CompilingOTBFromSource.html">Compiling OTB from source</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../OTB-Applications.html">A brief tour of OTB Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../QGIS-interface.html">QGIS interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Monteverdi.html">Monteverdi</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../AdvancedUse.html">Advanced Use</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Recipes.html">Recipes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Applications.html">Applications</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../C++.html">C++ API</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../SystemOverview.html">System Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Iterators.html">Iterators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Filters.html">Filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../StreamingAndThreading.html">Streaming and Threading</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../PersistentFilters.html">Persistent filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../WriteAnApplication.html">How to write an application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../AddingNewModules.html">Adding New Modules</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../Examples.html">Examples</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../Application.html">Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../BasicFilters.html">BasicFilters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeDetection.html">ChangeDetection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Classification.html">Classification</a></li>
<li class="toctree-l3"><a class="reference internal" href="../DimensionReduction.html">DimensionReduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../DisparityMap.html">DisparityMap</a></li>
<li class="toctree-l3"><a class="reference internal" href="../FeatureExtraction.html">FeatureExtraction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Filtering.html">Filtering</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Fusion.html">Fusion</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Hyperspectral.html">Hyperspectral</a></li>
<li class="toctree-l3"><a class="reference internal" href="../IO.html">IO</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Image.html">Image</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Installation.html">Installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Iterators.html">Iterators</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Learning.html">Learning</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Markov.html">Markov</a></li>
<li class="toctree-l3"><a class="reference internal" href="../OBIA.html">OBIA</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Patented.html">Patented</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Projections.html">Projections</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../Radiometry.html">Radiometry</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="ARVIMultiChannelRAndBAndNIRVegetationIndexImageFilter.html">ARVIMultiChannelRAndBAndNIRVegetationIndexImageFilter.cxx</a></li>
<li class="toctree-l4"><a class="reference internal" href="AVIMultiChannelRAndGAndNIRVegetationIndexImageFilter.html">AVIMultiChannelRAndGAndNIRVegetationIndexImageFilter.cxx</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">AtmosphericCorrectionSequencement.cxx</a></li>
<li class="toctree-l4"><a class="reference internal" href="NDVIRAndNIRVegetationIndexImageFilter.html">NDVIRAndNIRVegetationIndexImageFilter.cxx</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../Simulation.html">Simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Tutorials.html">Tutorials</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../FAQ.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Contributors.html">Contributors</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index_TOC.html">OTB CookBook</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index_TOC.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../C++.html">C++ API</a> &raquo;</li>
        
          <li><a href="../../Examples.html">Examples</a> &raquo;</li>
        
          <li><a href="../Radiometry.html">Radiometry</a> &raquo;</li>
        
      <li>AtmosphericCorrectionSequencement.cxx</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://gitlab.orfeo-toolbox.org/orfeotoolbox/OTB/blob/develop/Documentation/Cookbook/rst/C++/Examples/Radiometry/AtmosphericCorrectionSequencement.rst" class="fa fa-gitlab"> Edit on GitLab</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="atmosphericcorrectionsequencement-cxx">
<span id="id1"></span><h1>AtmosphericCorrectionSequencement.cxx<a class="headerlink" href="#atmosphericcorrectionsequencement-cxx" title="Permalink to this headline">Â¶</a></h1>
<p>Example usage:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./AtmosphericCorrectionSequencement Input/Romania_Extract.tif <span class="se">\</span>
                                    Output/AtmosphericCorrectionSequencement.tif <span class="se">\</span>
                                    Input/atmosphericCorrectionSequencement_alpha_beta.txt <span class="se">\</span>
                                    Input/atmosphericCorrectionSequencement_solar_illumination.txt <span class="se">\</span>
                                    Input/atmosphericCorrectionSequencement_wavelength_spectral_bands_spot4_1.txt <span class="se">\</span>
                                    <span class="m">27</span>.3 <span class="se">\</span>
                                    <span class="m">4</span> <span class="se">\</span>
                                    <span class="m">12</span> <span class="se">\</span>
                                    <span class="m">152</span>.7 <span class="se">\</span>
                                    <span class="m">2</span>.5 <span class="se">\</span>
                                    -77.0 <span class="se">\</span>
                                    <span class="m">1013</span>. <span class="se">\</span>
                                    <span class="m">2</span>.48134 <span class="se">\</span>
                                    <span class="m">0</span>.34400 <span class="se">\</span>
                                    <span class="m">1</span> <span class="se">\</span>
                                    <span class="m">0</span>.199854 <span class="se">\</span>
                                    <span class="m">2</span> <span class="se">\</span>
                                    <span class="m">0</span>.020
</pre></div>
</div>
<p>Example source code (<a class="reference external" href="https://gitlab.orfeo-toolbox.org/orfeotoolbox/otb/raw/develop/Examples/Radiometry/AtmosphericCorrectionSequencement.cxx?inline=false">AtmosphericCorrectionSequencement.cxx</a>):</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// \index{otb::MultiChannelRAndBAndNIRVegetationIndexImageFilter}</span>
<span class="c1">// \index{otb::MultiChannelRAndBAndNIRVegetationIndexImageFilter!header}</span>
<span class="c1">// \index{otb::VegetationIndex}</span>
<span class="c1">// \index{otb::VegetationIndex!header}</span>
<span class="c1">//</span>
<span class="c1">//</span>
<span class="c1">// The following example illustrates the application of atmospheric corrections to</span>
<span class="c1">// an optical multispectral image similar to Pleiades.</span>
<span class="c1">// These corrections are made in four steps :</span>
<span class="c1">// \begin{itemize}</span>
<span class="c1">// \item digital number to radiance correction;</span>
<span class="c1">// \item radiance to refletance image conversion;</span>
<span class="c1">// \item atmospheric correction for TOA (top of atmosphere) to TOC (top of canopy)</span>
<span class="c1">// reflectance estimation;</span>
<span class="c1">// \item correction of the adjacency effects taking into account the neighborhood contribution.</span>
<span class="c1">// \end{itemize}</span>
<span class="c1">//</span>
<span class="c1">// The manipulation of each class used for the different steps and the</span>
<span class="c1">// link with the 6S radiometry library will be explained. In particular,</span>
<span class="c1">// the API modifications that have been made in version 4.2 will be</span>
<span class="c1">// detailed. There was several reasons behind these modifications :</span>
<span class="c1">// \begin{itemize}</span>
<span class="c1">// \item fix design issues in the framework that were causing trouble</span>
<span class="c1">// when setting the atmospheric parameters</span>
<span class="c1">// \item allow the computation of the radiative terms by other libraries</span>
<span class="c1">// than 6S (such as SMAC method).</span>
<span class="c1">// \item allow the users of the OpticalCalibration application to set</span>
<span class="c1">// and override each correction parameter.</span>
<span class="c1">// \end{itemize}</span>
<span class="c1">//</span>
<span class="c1">// Let&#39;s look at the minimal code required to use this</span>
<span class="c1">// algorithm. First, the following header defining the</span>
<span class="c1">// \doxygen{otb}{AtmosphericCorrectionSequencement} class must be</span>
<span class="c1">// included.  For the numerical to radiance image, radiance to</span>
<span class="c1">// refletance image, and reflectance to atmospheric correction image</span>
<span class="c1">// corrections and the neighborhood correction, four header files are</span>
<span class="c1">// required.</span>

<span class="cp">#include</span> <span class="cpf">&quot;otbImageToRadianceImageFilter.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;otbRadianceToReflectanceImageFilter.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;otbReflectanceToSurfaceReflectanceImageFilter.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;otbSurfaceAdjacencyEffectCorrectionSchemeFilter.h&quot;</span><span class="cp"></span>

<span class="c1">// In version 4.2, the class \code{SurfaceAdjacencyEffect6SCorrectionSchemeFilter}</span>
<span class="c1">// has been renamed into \doxygen{otb}{SurfaceAdjacencyEffectCorrectionSchemeFilter},</span>
<span class="c1">// but it still does the same thing.</span>
<span class="c1">//</span>
<span class="c1">// This chain uses the 6S radiative</span>
<span class="c1">// transfer code to compute radiative terms (for instance upward and</span>
<span class="c1">// downward transmittance). The inputs needed are separated into</span>
<span class="c1">// two categories :</span>
<span class="c1">// \begin{itemize}</span>
<span class="c1">// \item The atmospheric correction parameters : physical parameters of the</span>
<span class="c1">// atmosphere when the image was taken (for instance : atmospheric pressure,</span>
<span class="c1">// water vapour amount, aerosol data, ...). They are stored in the class</span>
<span class="c1">// \footnote{Before version 4.2, this class was storing all correction</span>
<span class="c1">// parameters} \doxygen{otb}{AtmosphericCorrectionParameters}.</span>
<span class="c1">// \item The acquisition correction parameters : sensor related information</span>
<span class="c1">// about the way the image was taken, usually available with the image</span>
<span class="c1">// metadata (for instance : solar angles, spectral</span>
<span class="c1">// sensitivity, ...). They are stored in the class</span>
<span class="c1">// \doxygen{otb}{ImageMetadataCorrectionParameters}.</span>
<span class="c1">// \end{itemize}</span>
<span class="c1">//</span>
<span class="c1">// The class \doxygen{otb}{RadiometryCorrectionParametersToAtmisphericRadiativeTerms}</span>
<span class="c1">// computes the radiative terms using these two types of parameters. It</span>
<span class="c1">// contains a single static method that calls the 6S library. The header</span>
<span class="c1">// also includes the classes to manipulate correction parameters and radiative</span>
<span class="c1">// terms.</span>


<span class="cp">#include</span> <span class="cpf">&quot;otbVectorImage.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;otbImageFileReader.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;otbImageFileWriter.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">!=</span> <span class="mi">19</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Missing Parameters &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Usage: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; inputImage outputImage atmosphericCorrectionSequencement_alpha_beta.txt atmosphericCorrectionSequencement_solar_illumination.txt &quot;</span>
                 <span class="s">&quot;atmosphericCorrectionSequencement_wavelength_spectral_bands_spot4_1.txt SolarZenithalAngle day month SolarAzimuthalAngle &quot;</span>
                 <span class="s">&quot;ViewingZenithalAngle ViewingAzimuthalAngle AtmosphericPresure WaterVaporAmount OzoneAmount AerosolModel AerosolOpticalThickness &quot;</span>
                 <span class="s">&quot;WindowRadiusForAdjacencyCorrection PixelSpacing&quot;</span>
              <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Image types are now defined using pixel types and</span>
  <span class="c1">// dimension. The input image is defined as an \doxygen{otb}{VectorImage},</span>
  <span class="c1">// the output image is a \doxygen{otb}{VectorImage}. To simplify, input and</span>
  <span class="c1">// output image types are the same one.</span>

  <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span>                             <span class="n">Dimension</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="k">typedef</span> <span class="kt">double</span>                                 <span class="n">PixelType</span><span class="p">;</span>
  <span class="k">typedef</span> <span class="n">otb</span><span class="o">::</span><span class="n">VectorImage</span><span class="o">&lt;</span><span class="n">PixelType</span><span class="p">,</span> <span class="n">Dimension</span><span class="o">&gt;</span> <span class="n">ImageType</span><span class="p">;</span>

  <span class="c1">// We instantiate reader and writer types</span>
  <span class="k">typedef</span> <span class="n">otb</span><span class="o">::</span><span class="n">ImageFileReader</span><span class="o">&lt;</span><span class="n">ImageType</span><span class="o">&gt;</span> <span class="n">ReaderType</span><span class="p">;</span>
  <span class="k">typedef</span> <span class="n">otb</span><span class="o">::</span><span class="n">ImageFileWriter</span><span class="o">&lt;</span><span class="n">ImageType</span><span class="o">&gt;</span> <span class="n">WriterType</span><span class="p">;</span>
  <span class="n">ReaderType</span><span class="o">::</span><span class="n">Pointer</span>                     <span class="n">reader</span> <span class="o">=</span> <span class="n">ReaderType</span><span class="o">::</span><span class="n">New</span><span class="p">();</span>

  <span class="c1">// The \code{GenerateOutputInformation()} reader method is called</span>
  <span class="c1">// to know the number of component per pixel of the image.  It is</span>
  <span class="c1">// recommended to</span>
  <span class="c1">// place \code{GenerateOutputInformation} calls in a \code{try/catch} block in case</span>
  <span class="c1">// errors occur and exceptions are thrown.</span>

  <span class="n">reader</span><span class="o">-&gt;</span><span class="n">SetFileName</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
  <span class="k">try</span>
  <span class="p">{</span>
    <span class="n">reader</span><span class="o">-&gt;</span><span class="n">GenerateOutputInformation</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="k">catch</span> <span class="p">(</span><span class="n">itk</span><span class="o">::</span><span class="n">ExceptionObject</span><span class="o">&amp;</span> <span class="n">excep</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Exception caught !&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="n">excep</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">catch</span> <span class="p">(...)</span>
  <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Unknown exception !&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">EXIT_FAILURE</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">nbOfComponent</span> <span class="o">=</span> <span class="n">reader</span><span class="o">-&gt;</span><span class="n">GetOutput</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetNumberOfComponentsPerPixel</span><span class="p">();</span>

  <span class="c1">//-------------------------------</span>
  <span class="c1">// The \doxygen{otb}{ImageToRadianceImageFilter}</span>
  <span class="c1">// type is defined and instancied. This class uses a functor applied</span>
  <span class="c1">// to each component of each pixel ($\mathbf{X^{k}}$) whose formula is:</span>
  <span class="c1">//</span>
  <span class="c1">// \begin{equation}</span>
  <span class="c1">// \mathbf{L_{TOA}^{k}} = \frac{ X^{k} } { \alpha_{k} } + \beta_{k}.</span>
  <span class="c1">// \end{equation}</span>
  <span class="c1">//</span>
  <span class="c1">// Where :</span>
  <span class="c1">// \begin{itemize}</span>
  <span class="c1">// \item $\mathbf{L_{TOA}^{k}}$ is the incident radiance (in</span>
  <span class="c1">// $W.m^{-2}.sr^{-1}.\mu m^{-1}$);</span>
  <span class="c1">// \item $\mathbf{X^{k}}$ is the measured digital number (ie. the input image pixel component);</span>
  <span class="c1">// \item $\alpha_{k}$ is the absolute calibration gain for the channel k;</span>
  <span class="c1">// \item $\beta_{k}$ is the absolute calibration bias for the channel k.</span>
  <span class="c1">// \end{itemize}</span>

  <span class="k">typedef</span> <span class="n">otb</span><span class="o">::</span><span class="n">ImageToRadianceImageFilter</span><span class="o">&lt;</span><span class="n">ImageType</span><span class="p">,</span> <span class="n">ImageType</span><span class="o">&gt;</span> <span class="n">ImageToRadianceImageFilterType</span><span class="p">;</span>

  <span class="n">ImageToRadianceImageFilterType</span><span class="o">::</span><span class="n">Pointer</span>            <span class="n">filterImageToRadiance</span> <span class="o">=</span> <span class="n">ImageToRadianceImageFilterType</span><span class="o">::</span><span class="n">New</span><span class="p">();</span>
  <span class="k">typedef</span> <span class="n">ImageToRadianceImageFilterType</span><span class="o">::</span><span class="n">VectorType</span> <span class="n">VectorType</span><span class="p">;</span>
  <span class="n">VectorType</span>                                         <span class="n">alpha</span><span class="p">(</span><span class="n">nbOfComponent</span><span class="p">);</span>
  <span class="n">VectorType</span>                                         <span class="n">beta</span><span class="p">(</span><span class="n">nbOfComponent</span><span class="p">);</span>
  <span class="n">alpha</span><span class="p">.</span><span class="n">Fill</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="n">beta</span><span class="p">.</span><span class="n">Fill</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="n">std</span><span class="o">::</span><span class="n">ifstream</span> <span class="n">fin</span><span class="p">;</span>
  <span class="n">fin</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>
  <span class="kt">double</span> <span class="n">dalpha</span><span class="p">(</span><span class="mf">0.</span><span class="p">),</span> <span class="n">dbeta</span><span class="p">(</span><span class="mf">0.</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nbOfComponent</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">fin</span> <span class="o">&gt;&gt;</span> <span class="n">dalpha</span><span class="p">;</span>
    <span class="n">fin</span> <span class="o">&gt;&gt;</span> <span class="n">dbeta</span><span class="p">;</span>
    <span class="n">alpha</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">dalpha</span><span class="p">;</span>
    <span class="n">beta</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>  <span class="o">=</span> <span class="n">dbeta</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">fin</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>

  <span class="c1">// Here, $\alpha$ and $\beta$ are read from an ASCII file given in input,</span>
  <span class="c1">// stored in a vector and passed to the class.</span>

  <span class="n">filterImageToRadiance</span><span class="o">-&gt;</span><span class="n">SetAlpha</span><span class="p">(</span><span class="n">alpha</span><span class="p">);</span>
  <span class="n">filterImageToRadiance</span><span class="o">-&gt;</span><span class="n">SetBeta</span><span class="p">(</span><span class="n">beta</span><span class="p">);</span>

  <span class="c1">//-------------------------------</span>
  <span class="c1">// The \doxygen{otb}{RadianceToReflectanceImageFilter}</span>
  <span class="c1">// type is defined and instancied.</span>
  <span class="c1">// This class used a functor applied to each component of each pixel</span>
  <span class="c1">// of the radiance filter output ($\mathbf{L_{TOA}^{k}}$):</span>
  <span class="c1">//</span>
  <span class="c1">// \begin{equation}</span>
  <span class="c1">// \rho_{TOA}^{k} = \frac{ \pi.\mathbf{L_{TOA}^{k}} } { E_{S}^{k}.cos(\theta_{S}).d/d_{0} }.</span>
  <span class="c1">// \end{equation}</span>
  <span class="c1">//</span>
  <span class="c1">// Where :</span>
  <span class="c1">// \begin{itemize}</span>
  <span class="c1">// \item $\mathbf{\rho_{TOA}^{k}}$ is the reflectance measured by the sensor;</span>
  <span class="c1">// \item $\theta_{S}$ is the zenithal solar angle in degrees;</span>
  <span class="c1">// \item $E_{S}^{k}$ is the solar illumination out of the atmosphere measured at a distance</span>
  <span class="c1">// $d_{0}$ from the Earth;</span>
  <span class="c1">// \item $d/d_{0}$ is the ratio between the Earth-Sun distance at</span>
  <span class="c1">// the acquisition date and the mean Earth-Sun distance. The ratio can be directly</span>
  <span class="c1">// given to the class or computed using a 6S routine. TODO</span>
  <span class="c1">// In the last case (that is the one of this example), the user has to precise</span>
  <span class="c1">// the month and the day of the acquisition.</span>
  <span class="c1">// \end{itemize}</span>

  <span class="k">typedef</span> <span class="n">otb</span><span class="o">::</span><span class="n">RadianceToReflectanceImageFilter</span><span class="o">&lt;</span><span class="n">ImageType</span><span class="p">,</span> <span class="n">ImageType</span><span class="o">&gt;</span> <span class="n">RadianceToReflectanceImageFilterType</span><span class="p">;</span>
  <span class="n">RadianceToReflectanceImageFilterType</span><span class="o">::</span><span class="n">Pointer</span>                       <span class="n">filterRadianceToReflectance</span> <span class="o">=</span> <span class="n">RadianceToReflectanceImageFilterType</span><span class="o">::</span><span class="n">New</span><span class="p">();</span>

  <span class="k">typedef</span> <span class="n">RadianceToReflectanceImageFilterType</span><span class="o">::</span><span class="n">VectorType</span> <span class="n">VectorType</span><span class="p">;</span>

  <span class="n">VectorType</span> <span class="n">solarIllumination</span><span class="p">(</span><span class="n">nbOfComponent</span><span class="p">);</span>
  <span class="n">solarIllumination</span><span class="p">.</span><span class="n">Fill</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

  <span class="n">fin</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">4</span><span class="p">]);</span>
  <span class="kt">double</span> <span class="n">dsolarIllumination</span><span class="p">(</span><span class="mf">0.</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nbOfComponent</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">fin</span> <span class="o">&gt;&gt;</span> <span class="n">dsolarIllumination</span><span class="p">;</span>
    <span class="n">solarIllumination</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">dsolarIllumination</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">fin</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>

  <span class="c1">// The solar illumination is read from a ASCII file given in input,</span>
  <span class="c1">// stored in a vector</span>
  <span class="c1">// and given to the class.</span>
  <span class="c1">// Day, month and zenital solar angle are inputs and can be directly given to the class.</span>

  <span class="n">filterRadianceToReflectance</span><span class="o">-&gt;</span><span class="n">SetZenithalSolarAngle</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="n">atof</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">6</span><span class="p">])));</span>
  <span class="n">filterRadianceToReflectance</span><span class="o">-&gt;</span><span class="n">SetDay</span><span class="p">(</span><span class="n">atoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">7</span><span class="p">]));</span>
  <span class="n">filterRadianceToReflectance</span><span class="o">-&gt;</span><span class="n">SetMonth</span><span class="p">(</span><span class="n">atoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">8</span><span class="p">]));</span>
  <span class="n">filterRadianceToReflectance</span><span class="o">-&gt;</span><span class="n">SetSolarIllumination</span><span class="p">(</span><span class="n">solarIllumination</span><span class="p">);</span>

  <span class="c1">//-------------------------------</span>
  <span class="c1">// At this step of the chain, radiative information are nedeed to compute</span>
  <span class="c1">// the contribution of the atmosphere (such as atmosphere transmittance</span>
  <span class="c1">// and reflectance). Those information will be computed from different</span>
  <span class="c1">// correction parameters stored in \doxygen{otb}{AtmosphericCorrectionParameters}</span>
  <span class="c1">// and \doxygen{otb}{ImageMetadataCorrectionParameters} instances.</span>
  <span class="c1">// These {\em containers} will be given to the static function \texttt{Compute}</span>
  <span class="c1">// from \doxygen{otb}{RadiometryCorrectionParametersToAtmosphericRadiativeTerms}</span>
  <span class="c1">// class, which will call a 6S routine that will compute the needed</span>
  <span class="c1">// radiometric information and store them in a</span>
  <span class="c1">// \doxygen{otb}{AtmosphericRadiativeTerms} class instance.</span>
  <span class="c1">// For this,</span>
  <span class="c1">// \doxygen{otb}{RadiometryCorrectionParametersToAtmosphericRadiativeTerms},</span>
  <span class="c1">// \doxygen{otb}{AtmosphericCorrectionParameters},</span>
  <span class="c1">// \doxygen{otb}{ImageMetadataCorrectionParameters} and</span>
  <span class="c1">// \doxygen{otb}{AtmosphericRadiativeTerms}</span>
  <span class="c1">// types are defined and instancied.</span>

  <span class="k">typedef</span> <span class="n">otb</span><span class="o">::</span><span class="n">RadiometryCorrectionParametersToAtmosphericRadiativeTerms</span> <span class="n">RadiometryCorrectionParametersToRadiativeTermsType</span><span class="p">;</span>

  <span class="k">typedef</span> <span class="n">otb</span><span class="o">::</span><span class="n">AtmosphericCorrectionParameters</span> <span class="n">AtmosphericCorrectionParametersType</span><span class="p">;</span>

  <span class="k">typedef</span> <span class="n">otb</span><span class="o">::</span><span class="n">ImageMetadataCorrectionParameters</span> <span class="n">AcquisitionCorrectionParametersType</span><span class="p">;</span>

  <span class="k">typedef</span> <span class="n">otb</span><span class="o">::</span><span class="n">AtmosphericRadiativeTerms</span>                        <span class="n">AtmosphericRadiativeTermsType</span><span class="p">;</span>
  <span class="k">typedef</span> <span class="n">AtmosphericCorrectionParametersType</span><span class="o">::</span><span class="n">AerosolModelType</span> <span class="n">AerosolModelType</span><span class="p">;</span>
  <span class="k">typedef</span> <span class="n">otb</span><span class="o">::</span><span class="n">FilterFunctionValues</span>                             <span class="n">FilterFunctionValuesType</span><span class="p">;</span>
  <span class="k">typedef</span> <span class="n">FilterFunctionValuesType</span><span class="o">::</span><span class="n">ValuesVectorType</span>            <span class="n">ValuesVectorType</span><span class="p">;</span>

  <span class="n">AtmosphericCorrectionParametersType</span><span class="o">::</span><span class="n">Pointer</span> <span class="n">dataAtmosphericCorrectionParameters</span> <span class="o">=</span> <span class="n">AtmosphericCorrectionParametersType</span><span class="o">::</span><span class="n">New</span><span class="p">();</span>
  <span class="n">AcquisitionCorrectionParametersType</span><span class="o">::</span><span class="n">Pointer</span> <span class="n">dataAcquisitionCorrectionParameters</span> <span class="o">=</span> <span class="n">AcquisitionCorrectionParametersType</span><span class="o">::</span><span class="n">New</span><span class="p">();</span>
  <span class="n">AtmosphericRadiativeTermsType</span><span class="o">::</span><span class="n">Pointer</span>       <span class="n">dataAtmosphericRadiativeTerms</span>       <span class="o">=</span> <span class="n">AtmosphericRadiativeTermsType</span><span class="o">::</span><span class="n">New</span><span class="p">();</span>

  <span class="kt">float</span> <span class="n">minSpectralValue</span><span class="p">(</span><span class="mf">0.</span><span class="p">);</span>
  <span class="kt">float</span> <span class="n">maxSpectralValue</span><span class="p">(</span><span class="mf">0.</span><span class="p">);</span>
  <span class="kt">float</span> <span class="n">userStep</span><span class="p">(</span><span class="mf">0.</span><span class="p">);</span>
  <span class="kt">float</span> <span class="n">value</span><span class="p">(</span><span class="mf">0.</span><span class="p">);</span>

  <span class="kt">unsigned</span> <span class="kt">int</span>     <span class="n">nbBands</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="kt">unsigned</span> <span class="kt">int</span>     <span class="n">nbValuesPerBand</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span>      <span class="n">sString</span><span class="p">;</span>
  <span class="n">ValuesVectorType</span> <span class="n">vector</span><span class="p">;</span>

  <span class="n">fin</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">5</span><span class="p">]);</span>
  <span class="n">fin</span> <span class="o">&gt;&gt;</span> <span class="n">nbBands</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nbBands</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">vector</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
    <span class="n">fin</span> <span class="o">&gt;&gt;</span> <span class="n">sString</span><span class="p">;</span>
    <span class="n">fin</span> <span class="o">&gt;&gt;</span> <span class="n">minSpectralValue</span><span class="p">;</span>
    <span class="n">fin</span> <span class="o">&gt;&gt;</span> <span class="n">maxSpectralValue</span><span class="p">;</span>
    <span class="n">fin</span> <span class="o">&gt;&gt;</span> <span class="n">userStep</span><span class="p">;</span>
    <span class="n">fin</span> <span class="o">&gt;&gt;</span> <span class="n">nbValuesPerBand</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">nbValuesPerBand</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">fin</span> <span class="o">&gt;&gt;</span> <span class="n">value</span><span class="p">;</span>
      <span class="n">vector</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">value</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">FilterFunctionValuesType</span><span class="o">::</span><span class="n">Pointer</span> <span class="n">functionValues</span> <span class="o">=</span> <span class="n">FilterFunctionValuesType</span><span class="o">::</span><span class="n">New</span><span class="p">();</span>
    <span class="n">functionValues</span><span class="o">-&gt;</span><span class="n">SetFilterFunctionValues</span><span class="p">(</span><span class="n">vector</span><span class="p">);</span>
    <span class="n">functionValues</span><span class="o">-&gt;</span><span class="n">SetMinSpectralValue</span><span class="p">(</span><span class="n">minSpectralValue</span><span class="p">);</span>
    <span class="n">functionValues</span><span class="o">-&gt;</span><span class="n">SetMaxSpectralValue</span><span class="p">(</span><span class="n">maxSpectralValue</span><span class="p">);</span>
    <span class="n">functionValues</span><span class="o">-&gt;</span><span class="n">SetUserStep</span><span class="p">(</span><span class="n">userStep</span><span class="p">);</span>
    <span class="n">dataAcquisitionCorrectionParameters</span><span class="o">-&gt;</span><span class="n">SetWavelengthSpectralBandWithIndex</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">functionValues</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="n">fin</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>

  <span class="c1">// The \doxygen{otb}{ImageMetadataCorrectionParameters} class stores</span>
  <span class="c1">// several parameters that are generally present in the image metadata :</span>
  <span class="c1">// \begin{itemize}</span>
  <span class="c1">// \item The zenithal and azimutal solar angles that describe the solar incidence</span>
  <span class="c1">// configuration (in degrees);</span>
  <span class="c1">// \item The zenithal and azimuthal viewing angles that describe the viewing</span>
  <span class="c1">// direction (in degrees);</span>
  <span class="c1">// \item The month and the day of the acquisition;</span>
  <span class="c1">// \item The filter function that is the values of the filter function for one</span>
  <span class="c1">// spectral band, from $\lambda_{inf}$ to $\lambda_{sup}$ by step of 2.5 nm.</span>
  <span class="c1">// One filter function by channel is required.</span>
  <span class="c1">// This last parameter are read in text files, the other one are directly given to the class.</span>
  <span class="c1">// \end{itemize}</span>
  <span class="c1">//</span>
  <span class="c1">// When this container is not set in the ReflectanceToSurfaceReflectance</span>
  <span class="c1">// filter, it is automatically filled using the image metadata. The</span>
  <span class="c1">// following lines show that it is also possible to set the values manually.</span>

  <span class="c1">// Set parameters</span>
  <span class="n">dataAcquisitionCorrectionParameters</span><span class="o">-&gt;</span><span class="n">SetSolarZenithalAngle</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="n">atof</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">6</span><span class="p">])));</span>

  <span class="n">dataAcquisitionCorrectionParameters</span><span class="o">-&gt;</span><span class="n">SetSolarAzimutalAngle</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="n">atof</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">9</span><span class="p">])));</span>

  <span class="n">dataAcquisitionCorrectionParameters</span><span class="o">-&gt;</span><span class="n">SetViewingZenithalAngle</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="n">atof</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">10</span><span class="p">])));</span>

  <span class="n">dataAcquisitionCorrectionParameters</span><span class="o">-&gt;</span><span class="n">SetViewingAzimutalAngle</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="n">atof</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">11</span><span class="p">])));</span>

  <span class="n">dataAcquisitionCorrectionParameters</span><span class="o">-&gt;</span><span class="n">SetMonth</span><span class="p">(</span><span class="n">atoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">8</span><span class="p">]));</span>

  <span class="n">dataAcquisitionCorrectionParameters</span><span class="o">-&gt;</span><span class="n">SetDay</span><span class="p">(</span><span class="n">atoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">7</span><span class="p">]));</span>

  <span class="c1">// The \doxygen{otb}{AtmosphericCorrectionParameters} class stores</span>
  <span class="c1">// physical parameters of the atmosphere that are not impacted</span>
  <span class="c1">// by the viewing angles of the image :</span>
  <span class="c1">// \begin{itemize}</span>
  <span class="c1">// \item The atmospheric pressure;</span>
  <span class="c1">// \item The water vapor amount, that is, the total water vapor content over vertical</span>
  <span class="c1">// atmospheric column;</span>
  <span class="c1">// \item The ozone amount that is the Stratospheric ozone layer content;</span>
  <span class="c1">// \item The aerosol model that is the kind of particles (no aerosol, continental,</span>
  <span class="c1">// maritime, urban, desertic);</span>
  <span class="c1">// \item The aerosol optical thickness at 550 nm that is the is the Radiative impact</span>
  <span class="c1">//  of aerosol for the reference wavelength 550 nm;</span>
  <span class="c1">// \end{itemize}</span>

  <span class="n">dataAtmosphericCorrectionParameters</span><span class="o">-&gt;</span><span class="n">SetAtmosphericPressure</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="n">atof</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">12</span><span class="p">])));</span>

  <span class="n">dataAtmosphericCorrectionParameters</span><span class="o">-&gt;</span><span class="n">SetWaterVaporAmount</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="n">atof</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">13</span><span class="p">])));</span>

  <span class="n">dataAtmosphericCorrectionParameters</span><span class="o">-&gt;</span><span class="n">SetOzoneAmount</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="n">atof</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">14</span><span class="p">])));</span>

  <span class="n">AerosolModelType</span> <span class="n">aerosolModel</span> <span class="o">=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="n">AerosolModelType</span><span class="o">&gt;</span><span class="p">(</span><span class="o">::</span><span class="n">atoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">15</span><span class="p">]));</span>

  <span class="n">dataAtmosphericCorrectionParameters</span><span class="o">-&gt;</span><span class="n">SetAerosolModel</span><span class="p">(</span><span class="n">aerosolModel</span><span class="p">);</span>

  <span class="n">dataAtmosphericCorrectionParameters</span><span class="o">-&gt;</span><span class="n">SetAerosolOptical</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="n">atof</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">16</span><span class="p">])));</span>

  <span class="c1">// Once those parameters are loaded, they are used by the 6S library</span>
  <span class="c1">// to compute the needed radiometric information. The</span>
  <span class="c1">// RadiometryCorrectionParametersToAtmosphericRadiativeTerms class</span>
  <span class="c1">// provides a static function to perform this step\footnote{Before version</span>
  <span class="c1">// 4.2, it was done with the filter</span>
  <span class="c1">// AtmosphericCorrectionParametersTo6SAtmosphericRadiativeTerms}.</span>

  <span class="n">AtmosphericRadiativeTermsType</span><span class="o">::</span><span class="n">Pointer</span> <span class="n">atmosphericRadiativeTerms</span> <span class="o">=</span>
      <span class="n">RadiometryCorrectionParametersToRadiativeTermsType</span><span class="o">::</span><span class="n">Compute</span><span class="p">(</span><span class="n">dataAtmosphericCorrectionParameters</span><span class="p">,</span> <span class="n">dataAcquisitionCorrectionParameters</span><span class="p">);</span>

  <span class="c1">// The output is stored inside an instance of the</span>
  <span class="c1">// \doxygen{otb}{AtmosphericRadiativeTerms} class.</span>
  <span class="c1">// This class contains (for each channel of the image)</span>
  <span class="c1">// \begin{itemize}</span>
  <span class="c1">// \item The Intrinsic atmospheric reflectance that takes into account for the molecular scattering</span>
  <span class="c1">// and the aerosol scattering attenuated by water vapor absorption;</span>
  <span class="c1">// \item The spherical albedo of the atmosphere;</span>
  <span class="c1">// \item The total gaseous transmission (for all species);</span>
  <span class="c1">// \item The total transmittance of the atmosphere from sun to ground (downward transmittance)</span>
  <span class="c1">// and from ground to space sensor (upward transmittance).</span>
  <span class="c1">// \end{itemize}</span>

  <span class="c1">//-------------------------------</span>
  <span class="c1">// Atmospheric corrections can now start.</span>
  <span class="c1">// First, an instance of \doxygen{otb}{ReflectanceToSurfaceReflectanceImageFilter} is created.</span>

  <span class="k">typedef</span> <span class="n">otb</span><span class="o">::</span><span class="n">ReflectanceToSurfaceReflectanceImageFilter</span><span class="o">&lt;</span><span class="n">ImageType</span><span class="p">,</span> <span class="n">ImageType</span><span class="o">&gt;</span> <span class="n">ReflectanceToSurfaceReflectanceImageFilterType</span><span class="p">;</span>

  <span class="n">ReflectanceToSurfaceReflectanceImageFilterType</span><span class="o">::</span><span class="n">Pointer</span> <span class="n">filterReflectanceToSurfaceReflectanceImageFilter</span> <span class="o">=</span>
      <span class="n">ReflectanceToSurfaceReflectanceImageFilterType</span><span class="o">::</span><span class="n">New</span><span class="p">();</span>

  <span class="c1">// The aim of the atmospheric correction is to invert the surface reflectance</span>
  <span class="c1">// (for each pixel of the input image) from the TOA reflectance and from simulations</span>
  <span class="c1">// of the atmospheric radiative functions corresponding to the geometrical conditions</span>
  <span class="c1">// of the observation and to the atmospheric components.</span>
  <span class="c1">// The process required to be applied on each pixel of the image, band by band with</span>
  <span class="c1">// the following formula:</span>
  <span class="c1">//</span>
  <span class="c1">// \begin{equation}</span>
  <span class="c1">// \rho_{S}^{unif} = \frac{ \mathbf{A} }{ 1 + Sx\mathbf{A} }</span>
  <span class="c1">// \end{equation}</span>
  <span class="c1">// Where,</span>
  <span class="c1">// \begin{equation}</span>
  <span class="c1">// \mathbf{A} = \frac{ \rho_{TOA} - \rho_{atm} }{ T(\mu_{S}).T(\mu_{V}).t_{g}^{all gas} }</span>
  <span class="c1">// \end{equation}</span>
  <span class="c1">//</span>
  <span class="c1">// With :</span>
  <span class="c1">// \begin{itemize}</span>
  <span class="c1">// \item $\rho_{TOA}$ is the reflectance at the top of the atmosphere;</span>
  <span class="c1">// \item $\rho_{S}^{unif}$ is the ground reflectance under assumption</span>
  <span class="c1">// of a lambertian surface and an uniform environment;</span>
  <span class="c1">// \item $\rho_{atm}$ is the intrinsic atmospheric reflectance;</span>
  <span class="c1">// \item $t_{g}^{all gas}$ is the spherical albedo of the atmosphere;</span>
  <span class="c1">// \item $T(\mu_{S})$ is the downward transmittance;</span>
  <span class="c1">// \item $T(\mu_{V})$ is the upward transmittance.</span>
  <span class="c1">// \end{itemize}</span>
  <span class="c1">// All those parameters are contained in the AtmosphericRadiativeTerms</span>
  <span class="c1">// container.</span>

  <span class="n">filterReflectanceToSurfaceReflectanceImageFilter</span><span class="o">-&gt;</span><span class="n">SetAtmosphericRadiativeTerms</span><span class="p">(</span><span class="n">atmosphericRadiativeTerms</span><span class="p">);</span>

  <span class="c1">//-------------------------------</span>
  <span class="c1">// Next (and last step) is the neighborhood correction.</span>
  <span class="c1">// For this, the SurfaceAdjacencyEffectCorrectionSchemeFilter class is used.</span>
  <span class="c1">// The previous surface reflectance inversion is performed under the assumption of a</span>
  <span class="c1">// homogeneous ground environment. The following step allows correcting the adjacency</span>
  <span class="c1">// effect on the radiometry of pixels. The method is based on the decomposition of</span>
  <span class="c1">// the observed signal as the summation of the own contribution of the target pixel and</span>
  <span class="c1">// of the contributions of neighbored pixels moderated by their distance to the target pixel.</span>
  <span class="c1">// A simplified relation may be :</span>
  <span class="c1">// \begin{equation}</span>
  <span class="c1">// \rho{S} = \frac{ \rho_{S}^{unif}.T(\mu_{V}) - &lt;\rho{S}&gt;.t_{d}(\mu_{V}) }{ exp(-\delta/\mu_{V}) }</span>
  <span class="c1">// \end{equation}</span>
  <span class="c1">// With :</span>
  <span class="c1">// \begin{itemize}</span>
  <span class="c1">// \item $\rho_{S}^{unif}$ is the ground reflectance under assumption of an homogeneous environment;</span>
  <span class="c1">// \item $T(\mu_{V})$ is the upward transmittance;</span>
  <span class="c1">// \item $t_{d}(\mu_{S})$ is the upward diffus transmittance;</span>
  <span class="c1">// \item $exp(-\delta/\mu_{V})$ is the upward direct transmittance;</span>
  <span class="c1">// \item $\rho_{S}$ is the environment contribution to the pixel target reflectance in the total</span>
  <span class="c1">// observed signal.</span>
  <span class="c1">// \begin{equation}</span>
  <span class="c1">// \rho{S} = \sum{j}\sum{i}f(r(i, j))\times \rho_{S}^{unif}(i, j)</span>
  <span class="c1">// \end{equation}</span>
  <span class="c1">// where,</span>
  <span class="c1">// \begin{itemize}</span>
  <span class="c1">// \item r(i, j) is the distance between the pixel(i, j) and the central pixel of the window in $km$;</span>
  <span class="c1">// \item f(r) is the global environment function.</span>
  <span class="c1">// \begin{equation}</span>
  <span class="c1">// f(r) = \frac{t_{d}^{R}(\mu_{V}).f_{R}(r)+t_{d}^{A}(\mu_{V}).f_{A}(r)}{ t_{d}(\mu_{V}) }</span>
  <span class="c1">// \end{equation}</span>
  <span class="c1">// \end{itemize}</span>
  <span class="c1">// \end{itemize}</span>
  <span class="c1">// The neighborhood consideration window size is given by the window radius.</span>
  <span class="c1">//</span>
  <span class="c1">// An instance of \doxygen{otb}{SurfaceAdjacencyEffectCorrectionSchemeFilter}</span>
  <span class="c1">// is created. This class has an interface quite similar to</span>
  <span class="c1">// \doxygen{otb}{ReflectanceToSurfaceReflectance}. They both need radiative terms</span>
  <span class="c1">// (\doxygen{otb}{AtmosphericRadiativeTerms}), so it is possible to compute</span>
  <span class="c1">// them outside the filter and set them directly in the filter. The other</span>
  <span class="c1">// solution is to give as input the two parameters containers (&quot;atmospheric&quot;</span>
  <span class="c1">// and &quot;acquisition&quot; parameters), then the filter will compute the radiative</span>
  <span class="c1">// terms internally. If the &quot;acquisition&quot; correction parameters are not</span>
  <span class="c1">// present, the filter will try to get them from the image metadata.</span>

  <span class="k">typedef</span> <span class="n">otb</span><span class="o">::</span><span class="n">SurfaceAdjacencyEffectCorrectionSchemeFilter</span><span class="o">&lt;</span><span class="n">ImageType</span><span class="p">,</span> <span class="n">ImageType</span><span class="o">&gt;</span> <span class="n">SurfaceAdjacencyEffectCorrectionSchemeFilterType</span><span class="p">;</span>
  <span class="n">SurfaceAdjacencyEffectCorrectionSchemeFilterType</span><span class="o">::</span><span class="n">Pointer</span>                       <span class="n">filterSurfaceAdjacencyEffectCorrectionSchemeFilter</span> <span class="o">=</span>
      <span class="n">SurfaceAdjacencyEffectCorrectionSchemeFilterType</span><span class="o">::</span><span class="n">New</span><span class="p">();</span>

  <span class="c1">// Four inputs are needed to compute the neighborhood contribution:</span>
  <span class="c1">// \begin{itemize}</span>
  <span class="c1">// \item The radiative terms (stored in the AtmosphericRadiativeTerms container);</span>
  <span class="c1">// \item The zenithal viewing angle;</span>
  <span class="c1">// \item The neighborhood window radius;</span>
  <span class="c1">// \item The pixel spacing in kilometers.</span>
  <span class="c1">// \end{itemize}</span>
  <span class="n">filterSurfaceAdjacencyEffectCorrectionSchemeFilter</span><span class="o">-&gt;</span><span class="n">SetAtmosphericRadiativeTerms</span><span class="p">(</span><span class="n">atmosphericRadiativeTerms</span><span class="p">);</span>
  <span class="n">filterSurfaceAdjacencyEffectCorrectionSchemeFilter</span><span class="o">-&gt;</span><span class="n">SetZenithalViewingAngle</span><span class="p">(</span><span class="n">dataAcquisitionCorrectionParameters</span><span class="o">-&gt;</span><span class="n">GetViewingZenithalAngle</span><span class="p">());</span>
  <span class="n">filterSurfaceAdjacencyEffectCorrectionSchemeFilter</span><span class="o">-&gt;</span><span class="n">SetWindowRadius</span><span class="p">(</span><span class="n">atoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">17</span><span class="p">]));</span>
  <span class="n">filterSurfaceAdjacencyEffectCorrectionSchemeFilter</span><span class="o">-&gt;</span><span class="n">SetPixelSpacingInKilometers</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="n">atof</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">18</span><span class="p">])));</span>

  <span class="c1">//-------------------------------</span>
  <span class="n">WriterType</span><span class="o">::</span><span class="n">Pointer</span> <span class="n">writer</span> <span class="o">=</span> <span class="n">WriterType</span><span class="o">::</span><span class="n">New</span><span class="p">();</span>
  <span class="c1">// At this step, each filter of the chain is instancied and every one has its</span>
  <span class="c1">// input parameters set. A name can be given to the output image, each filter</span>
  <span class="c1">//  can be linked to the next one and create the final processing chain.</span>

  <span class="n">writer</span><span class="o">-&gt;</span><span class="n">SetFileName</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>

  <span class="n">filterImageToRadiance</span><span class="o">-&gt;</span><span class="n">SetInput</span><span class="p">(</span><span class="n">reader</span><span class="o">-&gt;</span><span class="n">GetOutput</span><span class="p">());</span>
  <span class="n">filterRadianceToReflectance</span><span class="o">-&gt;</span><span class="n">SetInput</span><span class="p">(</span><span class="n">filterImageToRadiance</span><span class="o">-&gt;</span><span class="n">GetOutput</span><span class="p">());</span>
  <span class="n">filterReflectanceToSurfaceReflectanceImageFilter</span><span class="o">-&gt;</span><span class="n">SetInput</span><span class="p">(</span><span class="n">filterRadianceToReflectance</span><span class="o">-&gt;</span><span class="n">GetOutput</span><span class="p">());</span>
  <span class="n">filterSurfaceAdjacencyEffectCorrectionSchemeFilter</span><span class="o">-&gt;</span><span class="n">SetInput</span><span class="p">(</span><span class="n">filterReflectanceToSurfaceReflectanceImageFilter</span><span class="o">-&gt;</span><span class="n">GetOutput</span><span class="p">());</span>

  <span class="n">writer</span><span class="o">-&gt;</span><span class="n">SetInput</span><span class="p">(</span><span class="n">filterSurfaceAdjacencyEffectCorrectionSchemeFilter</span><span class="o">-&gt;</span><span class="n">GetOutput</span><span class="p">());</span>

  <span class="c1">//  The invocation of the \code{Update()} method on the writer triggers the</span>
  <span class="c1">//  execution of the pipeline.  It is recommended to place this call in a</span>
  <span class="c1">//  \code{try/catch} block in case errors occur and exceptions are thrown.</span>
  <span class="k">try</span>
  <span class="p">{</span>
    <span class="n">writer</span><span class="o">-&gt;</span><span class="n">Update</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="k">catch</span> <span class="p">(</span><span class="n">itk</span><span class="o">::</span><span class="n">ExceptionObject</span><span class="o">&amp;</span> <span class="n">excep</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Exception caught !&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="n">excep</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">catch</span> <span class="p">(...)</span>
  <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Unknown exception !&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">EXIT_FAILURE</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">EXIT_SUCCESS</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="NDVIRAndNIRVegetationIndexImageFilter.html" class="btn btn-neutral float-right" title="NDVIRAndNIRVegetationIndexImageFilter.cxx" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="AVIMultiChannelRAndGAndNIRVegetationIndexImageFilter.html" class="btn btn-neutral" title="AVIMultiChannelRAndGAndNIRVegetationIndexImageFilter.cxx" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019 CNES. The OTB CookBook is licensed under a Creative Commons Attribution-ShareAlike 4.0 International license (CC-BY-SA).

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
    

  

  <script type="text/javascript" src="../../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>